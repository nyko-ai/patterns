id: sentry-setup
version: "1.0.0"
updated_at: "2026-01-31"
author: "nyko-team"
status: beta

name: "Sentry Error Tracking"
description: "Sentry error tracking and performance monitoring for Next.js"

category: monitoring
tags:
  - sentry
  - error-tracking
  - monitoring
  - performance
  - nextjs

difficulty: beginner
time_estimate: "15-20 min"

stack:
  required:
    - name: "@sentry/nextjs"
      version: "^10.38.0"
      reason: "Sentry SDK for Next.js"
    - name: "next"
      version: "^15.1.0"
      reason: "Next.js App Router"

requires: []

enables: []

env_vars:
  required:
    - key: SENTRY_DSN
      description: "Sentry Data Source Name"
      format: "https://xxx@xxx.ingest.sentry.io/xxx"
      where_to_find: "Sentry Dashboard > Settings > Projects > Client Keys"
    - key: SENTRY_AUTH_TOKEN
      description: "Sentry auth token for source maps"
      format: "sntrys_xxx"
      where_to_find: "Sentry Dashboard > Settings > Auth Tokens"
  optional:
    - key: SENTRY_ORG
      description: "Sentry organization slug"
      default: "your-org"
    - key: SENTRY_PROJECT
      description: "Sentry project slug"
      default: "your-project"

external_setup:
  - service: "Sentry"
    url: "https://sentry.io"
    steps:
      - "Create account at sentry.io"
      - "Create new project (select Next.js)"
      - "Copy DSN from Project Settings > Client Keys"
      - "Create Auth Token in Settings > Auth Tokens"
      - "Enable Performance monitoring in project settings"

files:
  - path: "sentry.client.config.ts"
    action: create
    description: "Sentry client-side configuration"
    priority: 1

  - path: "sentry.server.config.ts"
    action: create
    description: "Sentry server-side configuration"
    priority: 2

  - path: "sentry.edge.config.ts"
    action: create
    description: "Sentry edge runtime configuration"
    priority: 3

  - path: "next.config.ts"
    action: modify
    description: "Add Sentry webpack plugin"
    priority: 4

  - path: "app/global-error.tsx"
    action: create
    description: "Global error boundary with Sentry"
    priority: 5

  - path: "lib/sentry.ts"
    action: create
    description: "Sentry utilities"
    priority: 6

code:
  sentry.client.config.ts: |
    import * as Sentry from "@sentry/nextjs";

    Sentry.init({
      dsn: process.env.NEXT_PUBLIC_SENTRY_DSN,

      tracesSampleRate: process.env.NODE_ENV === "production" ? 0.1 : 1.0,

      replaysSessionSampleRate: 0.1,
      replaysOnErrorSampleRate: 1.0,

      integrations: [
        Sentry.replayIntegration({
          maskAllText: true,
          blockAllMedia: true,
        }),
        Sentry.browserTracingIntegration(),
      ],

      environment: process.env.NODE_ENV,

      beforeSend(event) {
        if (process.env.NODE_ENV === "development") {
          console.error("[Sentry]", event);
        }
        return event;
      },

      ignoreErrors: [
        "ResizeObserver loop",
        "Non-Error promise rejection",
        /^Loading chunk \d+ failed/,
      ],
    });

  sentry.server.config.ts: |
    import * as Sentry from "@sentry/nextjs";

    Sentry.init({
      dsn: process.env.SENTRY_DSN,

      tracesSampleRate: process.env.NODE_ENV === "production" ? 0.1 : 1.0,

      environment: process.env.NODE_ENV,

      integrations: [
        Sentry.prismaIntegration(),
      ],

      beforeSend(event) {
        if (event.request?.headers) {
          delete event.request.headers["authorization"];
          delete event.request.headers["cookie"];
        }
        return event;
      },
    });

  sentry.edge.config.ts: |
    import * as Sentry from "@sentry/nextjs";

    Sentry.init({
      dsn: process.env.SENTRY_DSN,
      tracesSampleRate: process.env.NODE_ENV === "production" ? 0.1 : 1.0,
      environment: process.env.NODE_ENV,
    });

  next.config.ts: |
    import { withSentryConfig } from "@sentry/nextjs";
    import type { NextConfig } from "next";

    const nextConfig: NextConfig = {
      // Your existing config
    };

    export default withSentryConfig(nextConfig, {
      org: process.env.SENTRY_ORG,
      project: process.env.SENTRY_PROJECT,
      authToken: process.env.SENTRY_AUTH_TOKEN,

      silent: !process.env.CI,
      widenClientFileUpload: true,
      hideSourceMaps: true,
      disableLogger: true,

      tunnelRoute: "/monitoring-tunnel",
    });

  app/global-error.tsx: |
    "use client";

    import * as Sentry from "@sentry/nextjs";
    import { useEffect } from "react";

    export default function GlobalError({
      error,
      reset,
    }: {
      error: Error & { digest?: string };
      reset: () => void;
    }) {
      useEffect(() => {
        Sentry.captureException(error);
      }, [error]);

      return (
        <html>
          <body>
            <div className="flex min-h-screen flex-col items-center justify-center">
              <h2 className="text-2xl font-bold">Something went wrong!</h2>
              <p className="mt-2 text-gray-600">
                We've been notified and are working on it.
              </p>
              <button
                onClick={reset}
                className="mt-4 rounded bg-blue-500 px-4 py-2 text-white hover:bg-blue-600"
              >
                Try again
              </button>
            </div>
          </body>
        </html>
      );
    }

  lib/sentry.ts: |
    import * as Sentry from "@sentry/nextjs";

    export function captureError(
      error: Error,
      context?: Record<string, unknown>
    ) {
      Sentry.captureException(error, {
        extra: context,
      });
    }

    export function captureMessage(
      message: string,
      level: Sentry.SeverityLevel = "info",
      context?: Record<string, unknown>
    ) {
      Sentry.captureMessage(message, {
        level,
        extra: context,
      });
    }

    export function setUser(user: { id: string; email?: string; name?: string } | null) {
      if (user) {
        Sentry.setUser({
          id: user.id,
          email: user.email,
          username: user.name,
        });
      } else {
        Sentry.setUser(null);
      }
    }

    export function addBreadcrumb(
      message: string,
      category: string,
      data?: Record<string, unknown>
    ) {
      Sentry.addBreadcrumb({
        message,
        category,
        data,
        level: "info",
      });
    }

    export function startSpan<T>(
      name: string,
      operation: string,
      callback: () => T
    ): T {
      return Sentry.startSpan(
        { name, op: operation },
        callback
      );
    }

    export async function startSpanAsync<T>(
      name: string,
      operation: string,
      callback: () => Promise<T>
    ): Promise<T> {
      return Sentry.startSpan(
        { name, op: operation },
        callback
      );
    }

edge_cases:
  - id: source-maps-not-uploaded
    symptom: "Error stack traces show minified code"
    cause: "Source maps not uploaded during build"
    solution: "Verify SENTRY_AUTH_TOKEN is set in CI, check build logs for upload errors"

  - id: dsn-not-set
    symptom: "Errors not appearing in Sentry"
    cause: "NEXT_PUBLIC_SENTRY_DSN not set"
    solution: "Add NEXT_PUBLIC_ prefix for client-side, verify .env.local"

  - id: pii-in-errors
    symptom: "Sensitive data in error reports"
    cause: "PII not filtered in beforeSend"
    solution: "Add data scrubbing rules in beforeSend hook"

  - id: rate-limiting
    symptom: "Sentry quota exceeded"
    cause: "Too many events sent"
    solution: "Lower tracesSampleRate, add ignoreErrors patterns, use beforeSend to filter"

validation:
  manual_test:
    - "Run npx @sentry/wizard@latest -i nextjs"
    - "Trigger test error in app"
    - "Verify error appears in Sentry dashboard"
    - "Check source maps resolve correctly"
    - "Verify user context is captured"
