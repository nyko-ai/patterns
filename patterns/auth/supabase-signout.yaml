id: supabase-signout
version: "1.0.0"
updated_at: "2026-01-30"
author: "nyko-team"
status: beta

name: "Supabase Sign Out"
description: "Complete sign out functionality for client and server-side"

category: auth
tags:
  - supabase
  - signout
  - logout
  - nextjs
  - authentication

difficulty: beginner
time_estimate: "10-15 min"

stack:
  required:
    - name: "next"
      version: "^15.1.0"
      reason: "App Router with server actions"
    - name: "@supabase/supabase-js"
      version: "^2.90.0"
      reason: "Supabase client library"
    - name: "@supabase/ssr"
      version: "^0.8.0"
      reason: "SSR utilities for cookie-based auth"

requires:
  - supabase-client-nextjs

enables: []

env_vars:
  required:
    - key: NEXT_PUBLIC_SUPABASE_URL
      description: "Supabase project URL"
      format: "https://xxx.supabase.co"
      where_to_find: "Supabase Dashboard > Project Settings > API"
    - key: NEXT_PUBLIC_SUPABASE_ANON_KEY
      description: "Supabase anonymous/public key"
      format: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      where_to_find: "Supabase Dashboard > Project Settings > API"

files:
  - path: "components/auth/sign-out-button.tsx"
    action: create
    description: "Client-side sign out button"
    priority: 1

  - path: "app/actions/auth.ts"
    action: create
    description: "Server action for sign out"
    priority: 2

  - path: "app/api/auth/signout/route.ts"
    action: create
    description: "API route alternative for sign out"
    priority: 3

code:
  components/auth/sign-out-button.tsx: |
    "use client";

    import { createClient } from "@/lib/supabase/client";
    import { useRouter } from "next/navigation";
    import { useState } from "react";

    interface SignOutButtonProps {
      className?: string;
      children?: React.ReactNode;
    }

    export function SignOutButton({
      className,
      children = "Sign out",
    }: SignOutButtonProps) {
      const [isLoading, setIsLoading] = useState(false);
      const router = useRouter();

      const handleSignOut = async () => {
        setIsLoading(true);
        const supabase = createClient();

        const { error } = await supabase.auth.signOut();

        if (error) {
          console.error("Error signing out:", error.message);
          setIsLoading(false);
          return;
        }

        // Refresh the page to clear any cached user data
        router.refresh();
        // Redirect to home or login page
        router.push("/");
      };

      return (
        <button
          onClick={handleSignOut}
          disabled={isLoading}
          className={
            className ||
            "rounded-lg px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 disabled:opacity-50"
          }
        >
          {isLoading ? "Signing out..." : children}
        </button>
      );
    }

  app/actions/auth.ts: |
    "use server";

    import { createClient } from "@/lib/supabase/server";
    import { redirect } from "next/navigation";

    export async function signOut() {
      const supabase = await createClient();
      await supabase.auth.signOut();
      redirect("/login");
    }

  app/api/auth/signout/route.ts: |
    import { createClient } from "@/lib/supabase/server";
    import { NextResponse } from "next/server";

    export async function POST() {
      const supabase = await createClient();
      const { error } = await supabase.auth.signOut();

      if (error) {
        return NextResponse.json(
          { error: error.message },
          { status: 500 }
        );
      }

      return NextResponse.json({ success: true });
    }

edge_cases:
  - id: session-not-cleared
    symptom: "User still appears logged in after sign out"
    cause: "Cookies not properly cleared or cached data persists"
    solution: |
      1. Call router.refresh() after signOut to clear server cache
      2. Ensure middleware updateSession is running
      3. Clear browser cookies manually to test
      4. Check for any client-side user state that needs resetting

  - id: redirect-after-signout
    symptom: "User redirected to wrong page after signing out"
    cause: "Middleware redirecting based on stale session"
    solution: |
      1. Use router.push('/') after signOut completes
      2. Ensure the redirect happens after the signOut promise resolves
      3. Consider using the server action which handles redirect

  - id: sign-out-from-all-devices
    symptom: "User signed out but still logged in on other devices"
    cause: "signOut only clears local session by default"
    solution: |
      To sign out from all devices, use:
      await supabase.auth.signOut({ scope: 'global' })

      Note: This invalidates all refresh tokens for the user.

  - id: sign-out-during-api-call
    symptom: "API call fails during sign out process"
    cause: "Session cleared before pending requests complete"
    solution: |
      1. Disable UI interactions during sign out
      2. Wait for any pending requests to complete
      3. Show a loading state to prevent multiple clicks
      4. Handle 401 errors gracefully in your API calls

validation:
  manual_test:
    - "Log in to the application"
    - "Navigate to a page with the SignOutButton"
    - "Click the sign out button"
    - "Verify loading state appears"
    - "Verify redirect to home/login page"
    - "Try to access a protected page"
    - "Verify redirect to login (session cleared)"
    - "Check browser cookies - sb-* cookies should be cleared"
