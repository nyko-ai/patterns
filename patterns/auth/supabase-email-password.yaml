id: supabase-email-password
version: "1.0.0"
updated_at: "2026-01-31"
author: "nyko-team"
status: beta

name: "Supabase Email/Password Auth"
description: "Email and password authentication with Supabase including email verification"

category: auth
tags:
  - supabase
  - email
  - password
  - verification
  - nextjs

difficulty: intermediate
time_estimate: "20-30 min"

stack:
  required:
    - name: "next"
      version: "^15.1.0"
      reason: "App Router with server components"
    - name: "@supabase/supabase-js"
      version: "^2.49.0"
      reason: "Supabase client library"
    - name: "@supabase/ssr"
      version: "^0.5.2"
      reason: "SSR utilities for cookie-based auth"
  optional:
    - name: "zod"
      version: "^3.24.0"
      reason: "Form validation"

requires:
  - supabase-client-nextjs

enables:
  - supabase-protected-routes

env_vars:
  required:
    - key: NEXT_PUBLIC_SUPABASE_URL
      description: "Supabase project URL"
      format: "https://xxx.supabase.co"
      where_to_find: "Supabase Dashboard > Project Settings > API"
    - key: NEXT_PUBLIC_SUPABASE_ANON_KEY
      description: "Supabase anonymous/public key"
      format: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      where_to_find: "Supabase Dashboard > Project Settings > API"

external_setup:
  - service: "Supabase"
    url: "https://supabase.com/dashboard"
    steps:
      - "Go to Authentication > Providers"
      - "Ensure Email provider is enabled"
      - "Configure 'Confirm email' setting (enable for verification)"
      - "Go to Authentication > Email Templates"
      - "Customize confirmation email template if needed"
      - "Set Site URL in Authentication > URL Configuration"
      - "Add redirect URLs for your app"

files:
  - path: "app/(auth)/signup/page.tsx"
    action: create
    description: "Sign up page with email/password form"
    priority: 1

  - path: "app/(auth)/login/page.tsx"
    action: create
    description: "Login page with email/password form"
    priority: 2

  - path: "app/(auth)/verify-email/page.tsx"
    action: create
    description: "Email verification pending page"
    priority: 3

  - path: "app/auth/confirm/route.ts"
    action: create
    description: "Email confirmation callback handler"
    priority: 4

  - path: "components/auth/signup-form.tsx"
    action: create
    description: "Sign up form component"
    priority: 5

  - path: "components/auth/login-form.tsx"
    action: create
    description: "Login form component"
    priority: 6

  - path: "lib/validations/auth.ts"
    action: create
    description: "Zod schemas for auth forms"
    priority: 7

code:
  app/(auth)/signup/page.tsx: |
    import { SignUpForm } from "@/components/auth/signup-form";
    import Link from "next/link";

    export default function SignUpPage() {
      return (
        <div className="flex min-h-screen items-center justify-center">
          <div className="w-full max-w-sm space-y-6 p-8">
            <div className="text-center">
              <h1 className="text-2xl font-bold">Create an account</h1>
              <p className="mt-2 text-gray-600">
                Enter your email to get started
              </p>
            </div>

            <SignUpForm />

            <p className="text-center text-sm text-gray-600">
              Already have an account?{" "}
              <Link href="/login" className="font-medium text-blue-600 hover:underline">
                Sign in
              </Link>
            </p>
          </div>
        </div>
      );
    }

  app/(auth)/login/page.tsx: |
    import { LoginForm } from "@/components/auth/login-form";
    import Link from "next/link";

    export default function LoginPage() {
      return (
        <div className="flex min-h-screen items-center justify-center">
          <div className="w-full max-w-sm space-y-6 p-8">
            <div className="text-center">
              <h1 className="text-2xl font-bold">Welcome back</h1>
              <p className="mt-2 text-gray-600">
                Sign in to your account
              </p>
            </div>

            <LoginForm />

            <p className="text-center text-sm text-gray-600">
              Don't have an account?{" "}
              <Link href="/signup" className="font-medium text-blue-600 hover:underline">
                Sign up
              </Link>
            </p>
          </div>
        </div>
      );
    }

  app/(auth)/verify-email/page.tsx: |
    import Link from "next/link";

    export default function VerifyEmailPage() {
      return (
        <div className="flex min-h-screen items-center justify-center">
          <div className="w-full max-w-sm space-y-6 p-8 text-center">
            <div className="mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-green-100">
              <svg className="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
              </svg>
            </div>
            
            <h1 className="text-2xl font-bold">Check your email</h1>
            <p className="text-gray-600">
              We sent you a verification link. Click the link in your email to verify your account.
            </p>
            
            <div className="pt-4">
              <Link 
                href="/login" 
                className="text-sm font-medium text-blue-600 hover:underline"
              >
                Back to login
              </Link>
            </div>
          </div>
        </div>
      );
    }

  app/auth/confirm/route.ts: |
    import { createClient } from "@/lib/supabase/server";
    import { NextResponse } from "next/server";
    import { type EmailOtpType } from "@supabase/supabase-js";

    export async function GET(request: Request) {
      const { searchParams, origin } = new URL(request.url);
      const token_hash = searchParams.get("token_hash");
      const type = searchParams.get("type") as EmailOtpType | null;
      const next = searchParams.get("next") ?? "/";

      if (token_hash && type) {
        const supabase = await createClient();
        const { error } = await supabase.auth.verifyOtp({
          type,
          token_hash,
        });

        if (!error) {
          return NextResponse.redirect(`${origin}${next}`);
        }
      }

      // Return to error page if verification fails
      return NextResponse.redirect(`${origin}/auth/error?message=Could not verify email`);
    }

  components/auth/signup-form.tsx: |
    "use client";

    import { createClient } from "@/lib/supabase/client";
    import { useState } from "react";
    import { useRouter } from "next/navigation";

    export function SignUpForm() {
      const [email, setEmail] = useState("");
      const [password, setPassword] = useState("");
      const [confirmPassword, setConfirmPassword] = useState("");
      const [error, setError] = useState<string | null>(null);
      const [isLoading, setIsLoading] = useState(false);
      const router = useRouter();

      const handleSubmit = async (e: React.FormEvent) => {
        e.preventDefault();
        setError(null);

        if (password !== confirmPassword) {
          setError("Passwords do not match");
          return;
        }

        if (password.length < 8) {
          setError("Password must be at least 8 characters");
          return;
        }

        setIsLoading(true);

        const supabase = createClient();
        const { error } = await supabase.auth.signUp({
          email,
          password,
          options: {
            emailRedirectTo: `${window.location.origin}/auth/confirm`,
          },
        });

        if (error) {
          setError(error.message);
          setIsLoading(false);
          return;
        }

        router.push("/verify-email");
      };

      return (
        <form onSubmit={handleSubmit} className="space-y-4">
          {error && (
            <div className="rounded-md bg-red-50 p-3 text-sm text-red-600">
              {error}
            </div>
          )}

          <div>
            <label htmlFor="email" className="block text-sm font-medium text-gray-700">
              Email
            </label>
            <input
              id="email"
              type="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              required
              className="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"
              placeholder="you@example.com"
            />
          </div>

          <div>
            <label htmlFor="password" className="block text-sm font-medium text-gray-700">
              Password
            </label>
            <input
              id="password"
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              required
              minLength={8}
              className="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"
              placeholder="At least 8 characters"
            />
          </div>

          <div>
            <label htmlFor="confirmPassword" className="block text-sm font-medium text-gray-700">
              Confirm Password
            </label>
            <input
              id="confirmPassword"
              type="password"
              value={confirmPassword}
              onChange={(e) => setConfirmPassword(e.target.value)}
              required
              className="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"
              placeholder="Confirm your password"
            />
          </div>

          <button
            type="submit"
            disabled={isLoading}
            className="w-full rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
          >
            {isLoading ? "Creating account..." : "Create account"}
          </button>
        </form>
      );
    }

  components/auth/login-form.tsx: |
    "use client";

    import { createClient } from "@/lib/supabase/client";
    import { useState } from "react";
    import { useRouter } from "next/navigation";

    export function LoginForm() {
      const [email, setEmail] = useState("");
      const [password, setPassword] = useState("");
      const [error, setError] = useState<string | null>(null);
      const [isLoading, setIsLoading] = useState(false);
      const router = useRouter();

      const handleSubmit = async (e: React.FormEvent) => {
        e.preventDefault();
        setError(null);
        setIsLoading(true);

        const supabase = createClient();
        const { error } = await supabase.auth.signInWithPassword({
          email,
          password,
        });

        if (error) {
          setError(error.message);
          setIsLoading(false);
          return;
        }

        router.push("/");
        router.refresh();
      };

      return (
        <form onSubmit={handleSubmit} className="space-y-4">
          {error && (
            <div className="rounded-md bg-red-50 p-3 text-sm text-red-600">
              {error}
            </div>
          )}

          <div>
            <label htmlFor="email" className="block text-sm font-medium text-gray-700">
              Email
            </label>
            <input
              id="email"
              type="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              required
              className="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"
              placeholder="you@example.com"
            />
          </div>

          <div>
            <label htmlFor="password" className="block text-sm font-medium text-gray-700">
              Password
            </label>
            <input
              id="password"
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              required
              className="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"
              placeholder="Your password"
            />
          </div>

          <button
            type="submit"
            disabled={isLoading}
            className="w-full rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
          >
            {isLoading ? "Signing in..." : "Sign in"}
          </button>
        </form>
      );
    }

  lib/validations/auth.ts: |
    import { z } from "zod";

    export const signUpSchema = z.object({
      email: z.string().email("Please enter a valid email"),
      password: z
        .string()
        .min(8, "Password must be at least 8 characters")
        .regex(/[A-Z]/, "Password must contain at least one uppercase letter")
        .regex(/[0-9]/, "Password must contain at least one number"),
      confirmPassword: z.string(),
    }).refine((data) => data.password === data.confirmPassword, {
      message: "Passwords do not match",
      path: ["confirmPassword"],
    });

    export const loginSchema = z.object({
      email: z.string().email("Please enter a valid email"),
      password: z.string().min(1, "Password is required"),
    });

    export type SignUpInput = z.infer<typeof signUpSchema>;
    export type LoginInput = z.infer<typeof loginSchema>;

edge_cases:
  - id: email-not-confirmed
    symptom: "Error: Email not confirmed after signing in"
    cause: "User hasn't clicked the verification link in their email"
    solution: |
      1. Check spam folder for verification email
      2. In Supabase Dashboard > Authentication > Users, you can manually confirm
      3. Or disable email confirmation in Authentication > Providers > Email

  - id: rate-limit-exceeded
    symptom: "Error: For security purposes, you can only request this once every 60 seconds"
    cause: "Too many sign-up attempts from same IP"
    solution: |
      1. Wait 60 seconds before retrying
      2. For development, you can increase limits in Supabase Dashboard
      3. Consider adding rate limiting UI feedback

  - id: user-already-registered
    symptom: "Error: User already registered"
    cause: "Email already exists in the system"
    solution: |
      1. Redirect user to login page
      2. Offer password reset option
      3. Check if they signed up with a different provider (OAuth)

  - id: weak-password
    symptom: "Error: Password should be at least 6 characters"
    cause: "Supabase has minimum password requirements"
    solution: |
      1. Enforce password requirements on frontend (8+ chars recommended)
      2. Show password strength indicator
      3. Match validation with Supabase settings in Dashboard

validation:
  manual_test:
    - "Navigate to /signup"
    - "Enter email and password (8+ characters)"
    - "Submit form"
    - "Check for redirect to /verify-email"
    - "Open email and click verification link"
    - "Verify redirect to home page"
    - "Sign out and try logging in with same credentials"
